import{_ as i,c as a,a3 as n,o as p}from"./chunks/framework.ohJJpums.js";const g=JSON.parse('{"title":"转载 使用 GitHub Actions 和 GitHub Pages 部署 VuePress 项目","description":"","frontmatter":{"license":{"type":"转载","author":"yxzlwz","source":"https://blog.yxzl.dev/article/xisaixvg/","license.link":"https://creativecommons.org/licenses/by-nc-sa/4.0/","license.name":"署名-非商业性-相同方式共享 4.0 国际 (CC-BY-NC-SA-4.0)"},"permalink":"/blog/argeggcn/"},"headers":[],"relativePath":"blog/argeggcn/index.md","filePath":"blog/GitHubVuepress.md","lastUpdated":1760067985000}'),l={name:"blog/argeggcn/index.md"};function h(t,s,e,k,E,r){return p(),a("div",null,s[0]||(s[0]=[n(`<h1 id="转载-使用-github-actions-和-github-pages-部署-vuepress-项目" tabindex="-1"><code>转载</code> 使用 GitHub Actions 和 GitHub Pages 部署 VuePress 项目 <a class="header-anchor" href="#转载-使用-github-actions-和-github-pages-部署-vuepress-项目" aria-label="Permalink to &quot;\`转载\` 使用 GitHub Actions 和 GitHub Pages 部署 VuePress 项目&quot;">​</a></h1><h2 id="配置-github-actions" tabindex="-1">配置 GitHub Actions <a class="header-anchor" href="#配置-github-actions" aria-label="Permalink to &quot;配置 GitHub Actions&quot;">​</a></h2><p>第一步是通过 GitHub 的工作流来打包项目。</p><p>下面是 vuepress-theme-hope 给出的配置文件，对于任何 VuePress 项目应该都适用：</p><blockquote><p>对原文补充：Vitepress 也 <s>（几乎）</s> 适用</p></blockquote><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">部署文档</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">permissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  contents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy-gh-pages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          fetch-depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 如果你文档需要 Git 子模块，取消注释下一行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # submodules: true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">设置 pnpm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">设置 Node.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">安装依赖</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          corepack enable</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">构建文档</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          NODE_OPTIONS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--max_old_space_size=8192</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|-</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm run build</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &gt; src/.vuepress/dist/.nojekyll</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">部署文档</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">JamesIves/github-pages-deploy-action@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 部署文档</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          branch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gh-pages</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          folder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">src/.vuepress/dist</span></span></code></pre></div><p>这个 action 会在每次 push 到 main 分支时触发，打包 VuePress 项目并将生成的静态文件推送到 gh-pages 分支。</p><p>使用时需要注意修改以下内容：</p><ul><li>branches：如果你的主分支不是 main，需要修改为你的主分支名称。</li><li>根据你的项目需要选择 node 和 pnpm 版本。如果你不使用 pnpm，删除相关内容即可。</li><li>folder：许多情况下，源文件目录可能不是 src，而是 docs 或 blog 等等。</li></ul><h2 id="配置-github-pages" tabindex="-1">配置 GitHub Pages <a class="header-anchor" href="#配置-github-pages" aria-label="Permalink to &quot;配置 GitHub Pages&quot;">​</a></h2><blockquote><p>此处不得不说 GitHub Pages 的文档写得一言难尽，甚至没说明白如何配置自定义域名的 CNAME 记录。</p></blockquote><p>如果需要使用自定义域名，建议先对想要使用的域名设置 CNAME 解析，指向 <code>your-github-username.github.io</code>。</p><p>然后，在 GitHub 仓库的设置中，找到 &quot;Pages&quot; 选项卡。</p><p>Branch 应选择上一步生成的 gh-pages 分支，目录选择根目录 <code>/ (root)</code>。</p><p>如果需要自定义域名，可同时在此界面中填写。</p><p>GitHub 可在验证完成 DNS 记录后为自定义域名自动生成 SSL 证书，这一步骤通常很快，但初次添加时仍有可能卡住几个小时。目前没有已知的有效方案，只能等待。如果长时间未能成功验证DNS信息，可以尝试删除自定义域名后重新添加。</p><p><img src="https://blog.yxzl.dev/assets/20614f85aa4627824ba31d95d5bf26d4-CDuXFKru.png" alt=""></p><h2 id="重新部署后自定义域名失效" tabindex="-1">重新部署后自定义域名失效 <a class="header-anchor" href="#重新部署后自定义域名失效" aria-label="Permalink to &quot;重新部署后自定义域名失效&quot;">​</a></h2><p>GitHub 存储自定义域名的方法是在选定的 Git 分支的根目录下放置一个名为 CNAME 的文件，文件内容为自定义域名。</p><p>而在上述设置中，每次重新部署时，GitHub Actions 会将 gh-pages 分支的内容替换为最新生成的静态文件，同时删除 CNAME 文件。</p><p>要在每次部署后保留该文件，最简单的方法是在 .vuepress/public 目录下手动创建 CNAME 文件，具体内容可以自行查看 GitHub 在 gh-pages 中自动生成的文件。</p><blockquote><p>以下为对原文的补充</p></blockquote><p>可选择在 actions 中自动生成 CNAME 文件</p><p>只需在构建文档时运行的命令中添加</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo &quot;yourdomain.com&quot; &gt; src/.vuepress/dist/CNAME</span></span></code></pre></div>`,25)]))}const c=i(l,[["render",h]]);export{g as __pageData,c as default};
